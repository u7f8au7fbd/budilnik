# Budilnik: TUIベースのAPI自動実行ツール
Budilnik（ブディルニク）は、CrosstermとRatatuiを使って開発された、ターミナルユーザーインターフェース（TUI）ベースのAPI自動実行ツールです。設定ファイル (config.json) に基づいて、指定した時刻または一定間隔でAPIを呼び出し、そのレスポンスをローカルに保存します。

## 目次
- 主な機能
- 使用方法
- 設定ファイル (config.json) の詳細
- ディレクトリ構造とデータ保存
- エラーハンドリング
## 1. 主な機能
   TUI (ターミナルユーザーインターフェース): ターミナル上で現在時刻、モード、ログ、ステータスメッセージなどをリアルタイムに表示します。\
   設定ファイル駆動: アプリケーションの動作モード（定刻モード/クロックモード）、APIエンドポイント、実行時間などは全て config.json から読み込まれます。\
   定刻モード: config.json で指定された特定の時刻（例: 毎日午前9時00分00秒）にAPIを自動実行します。\
   クロックモード: config.json で指定された一定の時間間隔（例: 3時間0分0秒ごと）でAPIを自動実行し、カウントダウンタイマーを表示します。\
   初回APIチェック: アプリケーション起動時に、タイマーに関係なく即座にAPIへの疎通確認（HTTPステータスコードの取得）を実行します。\
   APIレスポンスの保存: 初回呼び出し後、2回目以降のAPI呼び出しでは、APIレスポンス（JSON形式）をローカルファイルとして保存します。\
   ログ機能: API呼び出しの結果やアプリケーションの動作状況をリアルタイムでログ表示します。ログはスクロール可能です。\
   エラー表示: config.json の読み込み失敗やデータ保存ディレクトリの作成失敗など、重要なエラーが発生した場合は、ステータス欄に赤色でエラーメッセージを表示し、API関連の機能を停止します。\
   q キーを押すことで、いつでも安全にアプリケーションを終了できます。
## 2. 使用方法
### TUI操作
q キー: アプリケーションを終了します。\
↑ / ↓ キー: ログ表示エリアをスクロールします。\
Home キー: ログ表示エリアを一番上までスクロールします。\
End キー: ログ表示エリアを一番下までスクロールし、自動スクロールモードに戻します。
## 3. 設定ファイル (config.json) の詳細
   config.json はアプリケーションの動作を決定する重要なファイルです。プロジェクトのルートディレクトリに配置する必要があります。

### 例
```json
{
  "on_time": true,
    "time": {
    "h": 9,
    "m": 0,
    "s": 0
  },
  "api": "https://api.example.com/data"
}
```
各設定項目の説明
### on_time:
型: boolean\
**true の場合: 定刻モード (time で指定された特定の時刻にAPIを実行)。**\
**false の場合: クロックモード (time で指定された間隔ごとにAPIを実行)。**
### time:
型: object
APIを実行する「時刻」または「間隔」を指定します。\
**h: 時 (0-23)※1**\
**m: 分 (0-59)※2**\
**s: 秒 (0-59)※2**\
※1 クロックモードの際は24時間以上に設定可能です。\
※2 クロックモードの時は秒または分のいずれかを60以上にできますがそれ以外が0である必要があります。
### api:
型: string
呼び出すAPIのエンドポイントURL。

## 設定の例
### 定刻モードで毎日午前9時00分00秒にAPIを実行する場合:
```json
{
  "on_time": true,
    "time": {
    "h": 9,
    "m": 0,
    "s": 0
  },
  "api": "https://api.example.com/data"
}
```
### クロックモードで3時間30分ごとにAPIを実行する場合:
### 時:分:秒での指定
```json
{
  "on_time": false,
    "time": {
    "h": 3,
    "m": 30,
    "s": 0
  },
  "api": "https://api.example.com/data"
}
```
分での指定
```json
{
  "on_time": false,
    "time": {
    "h": 0,
    "m": 210,
    "s": 0
  },
  "api": "https://api.example.com/data"
}
```
### 秒での指定
```json
{
  "on_time": false,
    "time": {
    "h": 0,
    "m": 0,
    "s": 12600
  },
  "api": "https://api.example.com/data"
}
```
## 4. ディレクトリ構造とデータ保存
   Budilnikは、APIレスポンスのJSONデータを以下のディレクトリ構造で保存します。
```
.
├── budilnik       <-- 実行ファイル
├── config.json
└── jsons/         <-- データ保存のベースディレクトリ (自動生成)
    ├── 2023-10-26/  <-- 日付ごとのディレクトリ (例: 2023年10月26日)
    │   ├── 09-00-00.json
    │   ├── 09-05-30.json
    │   └── ...
    └── 20231027/
        ├── 12-34-56.json
        └── ...
```
data/: すべてのAPIレスポンスが保存されるルートディレクトリ。アプリケーション起動時に自動で作成されます。\
YYYYMMDD/: APIが呼び出された日付ごとに作成されるディレクトリ（例: 2023-10-26）。\
HH-MM-SS.json: APIレスポンスのJSONデータが保存されるファイル。ファイル名はAPI呼び出し時刻（時-分-秒）をハイフン区切りで表します。
## 5. エラーハンドリング
   Budilnikは、以下の重要なエラーに対してUIに赤色のメッセージを表示し、API関連の機能を停止しますが、アプリケーション自体は終了しません。
### config.json の読み込み失敗:
- ファイルが存在しない。
- JSON形式が不正である。
- 必要なフィールドが不足している。
この場合、UIは表示されますが、APIの機能は動作しません。q キーで終了できます。
### データ保存ディレクトリの作成失敗:
- data/YYYYMMDD ディレクトリの作成に失敗した場合。
権限の問題などが考えられます。
この場合もUIは表示され、エラーメッセージが表示されます。APIの機能は動作しません。q キーで終了できます。
エラー発生時でも、ユーザーはアプリケーションのログを確認し、q キーで安全に終了することができます。

### APIのリクエスト失敗
- apiが無効の可能性があります。